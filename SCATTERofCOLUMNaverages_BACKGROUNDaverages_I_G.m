

function    SCATTERofCOLUMNaverages_BACKGROUNDaverages_I_G                                                                                                                                                                                       (...
            average_intensities, background_intensities,filename                                                                                                                                                                                                                                   )   
%%  Description                                                                                                                                                                                            



%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%   
%   Inputs                                                                                                                                                                                     %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

%       A column vector of average intensities and, if this itself is not a background reading, another
%       column vector of background average intensities, and a filename.


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%   Outputs                                                                                                                                                                                    %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

%       A plot of the average intensities and, if it's separate, a plot of the background average 
%       intensities shifted to fit on the existing graph, but with the same scaling and its own axis
%       properly labeled.


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%   Description                                                                                                                                                                                %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

%       <>

%%  Common Scripts                                                                                                                                                                                         


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Calculations                                                                                                                                                                              %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%   Average Value (of matrix):              mean(mean(M))

%   Average Value (of matrix's columns):    mean(M)

%   Average Value (of matrix's rows):       mean(M')'

%   Average Value                           mean(M,n)
%   (of matrix along dimension n):



%   Max Value (of matrix):                  max(max(M))

%   Max Value (of matrix's columns):        max(M)

%   Max Value (of matrix's rows):           max(M')'



%   Min Value (of matrix):                  min(min(M))

%   Min Value (of matrix's columns):        min(M)

%   Min Value (of matrix's rows):           min(M')'


%   Norm (of vector):                       norm(v)


%   Pointwise calculations:                 v.*v', v.^2, ...


%   Variance (of matrix's columns):         var(M)



%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Colors                                                                                                                                                                                    %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%   Color to vector converter:              uisetcolor


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Conversions                                                                                                                                                                               %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%   Cell to Matrix:                         cell2mat(C)


%   Number to String:                       num2str(5) 


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%   Evaluating                                                                                                                                                                                 %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%   Program as Argument                     feval(<program>,<program inputs>)


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%   Exporting                                                                                                                                                                                  %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%   Matrix to .CSV:                         dlmwrite(filename,input,'precision',15);


%   Table to .TXT (comma separated)         writetable(input_table,'output location');


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%   Importing                                                                                                                                                                                  %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%   To Cell:                                readcell(<file location>,'Range','A4:C10');
%   To Matrix:                              readmatrix(<file location>,'Range',[<starting row> <starting column>]);
%   To Table:                               readcell(<file location>,'Range','B4');


%   Directory to Structure:                 dir(['directory location\' '*.txt']);


%   Excel File to Cell Array:               [~,~,output]=xlsread(input);


%   .TXT to Table:                          readtable(input)  


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%   Searching                                                                                                                                                                                  %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%   Condition as an index:                  x(x<=0)=inf     


%   Indices and values satisfying           [row,column,value_when_evaluated]=find(losses==min(losses))
%   a condition


%   Is an element a member:                 ismember(<element>,<set>)


%   Unique Elements of Matrix:              [unique_elements, lowest_index_of_occurence,unique_indices]=unique(M)


%   Unique Elements, Number of Occurences:  accumarray(unique_indices,1)    


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
%   Strings                                                                                                                                                                                    %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%   Does it Contain:                        contains(<string>,<substring>)


%   Divide in Two:                          [before,remainder] = strtok(<string>,<delimater>)


%   Divide into Portions:                   split(<string>,<delimiter>)   


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%   System commands                                                                                                                                                                            %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%   Copyfile:                               copyfile('original location','new location','f')


%   Make directory:                         mkdir([output '\<folder name>']);


%   Movefile:                               movefile('original location','new location','f')


%   Shut down:                              system('shutdown -s')




%%  Creating the figure and setting the image size                                                                                                                                                         



%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Create a figure                                                                                                                                                                           %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

graph = figure('InvertHardcopy','off','Visible','off','Color',[1 1 1]);
                 
             
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Set the image size                                                                                                                                                                        %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
            
set(gcf,'PaperUnits','inches','PaperPosition',[0 0 21 8]);


%%  Create the axes and plot the average intensities                                                                                                                                                       


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    The axes, set font and position                                                                                                                                                           %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

axes_intensities = axes('Parent',graph,'FontName','Palatino Linotype','FontSize',12,'Position',...
                      [0.0483267479549314 0.10387323943662 0.874162613747196 0.805281690140842]);
                                 

%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    The plot                                                                                                                                                                                  %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

plot([1:length(average_intensities)]',average_intensities,'Color',[0 0 0],'LineWidth', 2)


%%  Set axes properties and hold                                                                                                                                                                           

%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Bounds                                                                                                                                                                                    %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

xlim(axes_intensities,[0 length(average_intensities(:,1))+1]);
ylim(axes_intensities,[min(average_intensities) max(average_intensities)]);


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Box around axes (off)                                                                                                                                                                     %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

box(axes_intensities,'off');


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Labels:  find the order of magnitude used on the y-axis                                                                                                                                   %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

y_ticks = axes_intensities.YTick;

minimum_order_of_magnitude=0;

for i=-10:10
    if y_ticks(1,2)/10^i>=1 && y_ticks(1,2)/10^(i+1)<=1
        minimum_order_of_magnitude=i;
        break
    end
end



%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Labels:  set the scientific exponent to zero but keep the tick labeling                                                                                                                   %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

if ~minimum_order_of_magnitude==0
    
    axes_intensities.YRuler.Exponent = 0;

    axes_intensities.YTickLabel=cellstr(num2str(y_ticks(:)/10^minimum_order_of_magnitude));
    
end


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Labels:  label the axes                                                                                                                                                                   %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

axes_histogram_x_label=xlabel('Time','FontWeight','bold','FontSize',16,'FontName','Palatino Linotype');


if minimum_order_of_magnitude==-1 
    
    axes_histogram_y_label=ylabel({'Average Intensity \times 10'},...
        'FontWeight','bold','FontSize',16,'FontName','Palatino Linotype');


elseif ~minimum_order_of_magnitude==0 
    
    axes_histogram_y_label=ylabel({strcat('Average Intensity \times 10^{',num2str(-minimum_order_of_magnitude),'}')},...
        'FontWeight','bold','FontSize',16,'FontName','Palatino Linotype');
           
       
else
    
    axes_histogram_y_label=ylabel({'Average Intensity'},'FontWeight','bold','FontSize',16,'FontName','Palatino Linotype');
    
end
        

%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Labels: Positions                                                                                                                                                                         %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

set(axes_histogram_x_label, 'Units', 'Normalized', 'Position', [0.5, -0.07, 0]);


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Ticks facing out                                                                                                                                                                          %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

axes_intensities.XAxis.TickDirection='out';
axes_intensities.YAxis.TickDirection='out';


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Hold axes                                                                                                                                                                                 %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%


%%  Set background intensity axes properties, if there is a background itensity, hold, and then plot...                                                                                                    
%   the background intensities                                                                                                                                   


if ~isempty(background_intensities)

%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Create the axes and set some properties                                                                                                                                                   %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

axes_background_intensities = axes('Position',get(axes_intensities, 'Position'),'XAxisLocation','top','YAxisLocation',...
       'right','Color','none','XColor','[1 1 1]','YColor',[0.9804    0.4745    0.0275],'FontName','Palatino Linotype');
       
   
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Bounds:  scrunch the background intensity plot down vertically                                                                                                                            %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%
   
xlim(axes_background_intensities,[0 length(average_intensities(:,1))+1]); 
ylim(axes_background_intensities,[0 6*max(background_intensities)]); 


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Labels:  place the y-axis ticks                                                                                                                                                           %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

set(axes_background_intensities,'ytick',...
    linspace(min(background_intensities),max(background_intensities),2))


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Labels:  find the order of magnitude used on the y-axis                                                                                                                                   %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

y_ticks = axes_background_intensities.YTick;

minimum_order_of_magnitude=0;

for i=-10:10
    if y_ticks(1,2)/10^i>=1 && y_ticks(1,2)/10^(i+1)<=1
        minimum_order_of_magnitude=i;
        break
    end
end


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Labels:  set the scientific exponent to zero but keep the tick labeling                                                                                                                   %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

if ~minimum_order_of_magnitude==0
    
    axes_background_intensities.YRuler.Exponent = 0;

    axes_background_intensities.YTickLabel=cellstr(num2str(y_ticks(:)/10^minimum_order_of_magnitude));
    
end


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Labels:  label the y-axis                                                                                                                                                                 %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

if minimum_order_of_magnitude==-1 

    y=ylabel({'Background Average Intensity \times 10'},'FontWeight','bold','FontSize',16,...
           'FontName','Palatino Linotype','Rotation',270,'Color',[0.9804    0.4745    0.0275]);

       
elseif ~minimum_order_of_magnitude==0 

    y=ylabel({strcat('Background Average Intensity \times 10^{',num2str(-i),'}')},'FontWeight','bold',...
           'FontSize',16,'FontName','Palatino Linotype','Rotation',270,'Color',[0.9804    0.4745    0.0275]);
       
else      
    
    y=ylabel({'Background Average Intensity'},'FontWeight','bold',...
           'FontSize',16,'FontName','Palatino Linotype','Rotation',270,'Color',[0.9804    0.4745    0.0275]);
       
end
 

%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Labels: Positions                                                                                                                                                                         %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

set(y, 'Units', 'Normalized', 'Position', [1.065, 0.5, 0]);


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Ticks                                                                                                                                                                                     %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

axes_background_intensities.YAxis.TickLabelFormat='%,.2f';
axes_background_intensities.YAxis.TickDirection='out';

                                                                                                                                            
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Link the two x axes and put the hold on                                                                                                                                                   %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

linkaxes([axes_intensities axes_background_intensities],'x');

hold on


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Plot the background intensities                                                                                                                                                           %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

plot(background_intensities,'Parent',axes_background_intensities,'Color',[0.9804    0.4745    0.0275],'LineWidth', 2);


end


%%  Saving the figure and clearing the memory                                                                                                                                                              


%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Save the figure (saving as .jpg produces severe RAM spikes)                                                                                                                               %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

print(graph,'-dbmp',[filename '.bmp'] , '-r400');

%print(graph,'-djpeg',[filename '.jpg'] , '-r600');

%saveas(graph, [filename '.jpg']);

%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------% 
%    Clear and close the current figure (very necessary; the effects of these commands are sensitive to their placement)                                                                       %  
%----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------%

clf
close(gcf)


end